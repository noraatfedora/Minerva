{% extends "base.html" %} {% block content %}
<script>
  function explainScore() {
    var message =
      "The priority is calculated by the amount of time it has been " +
      "since each stop on the route has been last delivered. " +
      "The higher the priority, the more urgent this route is. When a volunteer claims the next route, they're " +
      "given the route with the highest priority.";
    window.alert(message);
  }
  $(function () {
})
</script>
<!--
<style>
  .card-container {
      flex-direction: row;
      display:flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: flex-start;
  }
  .card {
      margin: 1%;
  }
</style>
-->
<center>
  <h2>Routes</h2>
  <form
    name="generate-routes"
    id="generate-routes"
    class="form"
    action=""
    method="post"
    onsubmit="return verifyForm()"
  >
    Number of vehicles:
    <input
      type="number"
      class="form-control col-md-1"
      value="40"
      id="num-vehicles"
      name="num-vehicles"
    />
    <div class="spacer"></div>
    Note: The number of vehicles is a rough estimate, the route planning
    algorithm might make a couple of empty routes.
    <div class="spacer"></div>
    <input type="hidden" name="redirect" value="loading" />
    <button
      type="submit"
      name="submit"
      class="btn bw-btn center-block blue-hover"
    >
      Generate new routes
    </button>
  </form>
  <div class="spacer"></div>
  <a href="/routes-spreadsheet" name="assign-all" class="btn bw-btn blue-hover"
    >Download routes as spreadsheet</a
  >
  <div class="spacer"></div>
  <div class="card-container">
    {% for route in routes %}
      <div class="card grid-card text-left task-incomplete">
        <div class="card-header">Route ID: {{ route['id'] }}</div>
        <div class="card-header">
          Length: {{ route['parsedContent']|length - 2 }} stops
        </div>
        <div class="card-header">
          Priority: {{ route['weightedScore'] }}
          <small><a href="javascript:explainScore()">What's this?</a></small>
        </div>
        <div class="card-header">
          <a href="{{ route['google_maps'] }}">View Map</a>
        </div>
        <div class="card-header">
          <a
            class="btn bw-btn"
            data-toggle="collapse"
            href="#collapse-route-{{ route['id'] }}"
            role="button"
            aria-expanded="false"
            aria-controls="collapse-route-{{ route['id'] }}"
          >
            {% if route['userList']|length==1 %} Show 1 stop {% else %} Show {{
            route['userList']|length }} stops {% endif %}
          </a>
        </div>
        <div id="collapse-route-{{ route['id'] }}" class="collapse">
          {% for user in route['userList'] %}
          <div class="card bg-light" id="user-header-{{ user['id'] }}">
            <a
              class="btn btn-link"
              target="_bland"
              rel="noopener noreferrer"
              href="/allorders#card-{{ user['id'] }}"
            >
              {{ user['address'] }}
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</center>
{% endblock content %}
